<html>
    <head>
        <title>Mandlebrot Plot</title>
        <script src="https://unpkg.com/mathjs@7.2.0/dist/math.min.js" type="text/javascript"/></script>
    </head>
    <body bgcolor="black">
    <label style="color: white;">Y Center</label>
    <input id="xcenter" type="number" min="-5" max="5" value="0"> <br />
    <label style="color: white;">X Center</label>
    <input id="ycenter" type="number" min="-5" max="5" value="0"> <br />
    <label style="color: white;">Iterations</label>
    <input id="iterations" type="number" min="10" max="10000" value="10"> <br />
    <label style="color: white;">Iterative Y Range</label>
    <input id="xrangemin" type="number" max="0" value="-2">
    <input id="xrangemax" type="number" min ="0" value="2"> <br />
    <label style="color: white;">Iterative X Range</label>
    <input id="yrangemin" type="number" max="0" value="-2">
    <input id="yrangemax" type="number" min ="0" value="2"> <br />
    <button id="clickBtn" onclick="draw()">Redraw</button>
    <center>
        <canvas id="manCanvas" height="800" width="800"></canvas>
    </center>
    </body>
    <script>

        var canvas;
        var canvasContext;
        var dimension;
        var centerx;
        var centery;
        var iters;
        var xmin;
        var xmax;
        var ymin;
        var ymax;

        function draw()
        {
            alert("Draw Started")
            document.getElementById("clickBtn").enabled = false
            updateVals()
            drawgrid();
            drawmandel();
            document.getElementById("clickBtn").enabled = true
            alert("Plot Finished")
        }
        function drawLine(startx,starty,endx,endy)
        {
        canvasContext.moveTo(startx, starty);
        canvasContext.lineTo(endx, endy);
        canvasContext.stroke();
        }

        function addText(x,y,text)
        {
            canvasContext.font = "10px Arial";
            canvasContext.fillStyle = "White"
            canvasContext.fillText(text, x, y);
        }

        function updateVals()
        {
        canvas = document.getElementById("manCanvas");
        canvasContext = canvas.getContext("2d");
        dimension = canvas.height;
        centerx = parseInt(document.getElementById("xcenter").value);
        centery = parseInt(document.getElementById("ycenter").value);
        iters = parseInt(document.getElementById("iterations").value);
        xmin = parseInt(document.getElementById("xrangemin").value);
        xmax = parseInt(document.getElementById("xrangemax").value);
        ymin = parseInt(document.getElementById("yrangemin").value);
        ymax = parseInt(document.getElementById("yrangemax").value);
        }

        function drawgrid(){
            canvasContext.clearRect(0, 0, canvas.height, canvas.width);
            canvasContext.beginPath();
            canvas = document.getElementById("manCanvas");
            canvasContext = canvas.getContext("2d");
            dimension = document.getElementById("manCanvas").height;
        
            canvasContext.strokeStyle = "#ffffff";

            //Box
            drawLine(0,0,0,dimension);
            drawLine(dimension,0,dimension,dimension);
            drawLine(0,0,dimension,0);
            drawLine(0,dimension,dimension,dimension);

            //Axis
            drawLine(dimension/2 + centery,0,dimension/2 + centery,dimension); //y
            drawLine(0,dimension/2  - centerx,dimension,dimension/2 - centerx); //x

            for(i = 0; i <= dimension; i = i+50) //Ticks + Labels
            {
                drawLine(i,dimension/2 - centerx,i,dimension/2 + 5 - centerx)
                drawLine(dimension/2 + centery,i,dimension/2 + 5 + centery,i)
                addText(i,dimension/2 - centerx + 15,-(dimension/2 + centerx - i)/100)
                addText(dimension/2 + centery + 5,i,(dimension/2 - centery - i)/100)
            }
        }
        //Mandelbrot Equation: z = z^2 +c

        function drawmandel(){
        for (h=xmin; h<=xmax; h = h+0.01) //Loop between -2 < y < 2
        {
            for (i = ymin; i < ymax; i = i+0.01)    //Loop between -2 < x < 2
            {   
                z = 0   //Start from 0
                console.log("Mandelbrotting " + i + " + " + h)
                for(j=0; j < iters; j++)
                {
                    //z=null;
                    z = math.add(math.multiply(z,z),math.complex(i,h))    //z_(n+1) = z_(n)^2 + c
                    //async (z) => {await func(z,math.complex(i,h));}  

                    if(z == Infinity || z.toString() == "NaN")
                    {
                        break;
                    }     
                }
                if(z != Infinity && z.toString() != "NaN")
                {
                    console.log("Final value after iters " + z)
                    canvasContext.strokeStyle = "#00FF00";
                    canvasContext.strokeRect((dimension/2) + centery + (i*100),dimension/2 - centerx - (h*100),0.1,0.1);
                }
            }
        }    
    }
    </script>
</html>
